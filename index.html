
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOR Pi MAXIMUM TRANSACTION - Minimal Demo</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .status-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #6c757d;
        }
        .status-box.loading {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status-box.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .status-box.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .status-text {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-login:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-payment {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .btn-payment:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        .user-info {
            background: #e7f3ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        .user-info.show {
            display: block;
        }
        .user-name {
            font-size: 16px;
            font-weight: 700;
            color: #0066cc;
        }
        .log-container {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }
        .log-title {
            color: #fff;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .log-entry {
            font-size: 11px;
            font-family: 'Courier New', monospace;
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        .log-info {
            color: #61dafb;
        }
        .log-success {
            color: #98c379;
        }
        .log-error {
            color: #e06c75;
        }
        .log-warning {
            color: #e5c07b;
        }
        .icon {
            font-size: 20px;
        }
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>🥧 FOR Pi MAXIMUM TRANSACTION</h1>
    <p class="subtitle">Pi Network SDK Integration Demo</p>
    
    <div id="sdkStatus" class="status-box loading">
        <div class="status-text">
            <span class="spinner"></span>
            <span style="margin-left: 10px;">SDK 초기화 중...</span>
        </div>
    </div>
    
    <div id="userInfo" class="user-info">
        <div class="user-name" id="userName">User: Not logged in</div>
    </div>
    
    <button id="loginBtn" class="btn btn-login" onclick="handleLogin()" disabled>
        <span class="icon">🔐</span>
        <span>Pi Login (Authenticate)</span>
    </button>
    
    <button id="paymentBtn" class="btn btn-payment" onclick="handlePayment()" disabled>
        <span class="icon">💰</span>
        <span>Request Payment (0.01 Pi)</span>
    </button>
    
    <div class="log-container">
        <div class="log-title">📋 Activity Log</div>
        <div id="logContent"></div>
    </div>
    
    <div class="footer">
        <div>Testnet Mode | Hackathon Demo</div>
        <div style="margin-top: 5px;">App Key: epc4...5cas</div>
    </div>
</div>

<script>
// ============================================
// Pi SDK 통합 (호스팅 통과용 최소 구성)
// ============================================

const APP_KEY = "epc4mx46e6y2s6l8bhm1hrcmeuzkbpuprwmvlm5ktfzs2g0pnikqh8pcorkk5cas";
let piSDK = null;
let authenticatedUser = null;

// 로그 함수
function addLog(message, type = 'info') {
    const logContent = document.getElementById('logContent');
    const timestamp = new Date().toLocaleTimeString();
    const logClass = `log-${type}`;
    
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${logClass}`;
    logEntry.textContent = `[${timestamp}] ${message}`;
    
    logContent.appendChild(logEntry);
    logContent.scrollTop = logContent.scrollHeight;
    
    console.log(`[${type.toUpperCase()}] ${message}`);
}

// SDK 상태 업데이트
function updateSDKStatus(message, status = 'loading') {
    const statusBox = document.getElementById('sdkStatus');
    statusBox.className = `status-box ${status}`;
    
    let icon = '⏳';
    if (status === 'success') icon = '✅';
    if (status === 'error') icon = '❌';
    
    statusBox.innerHTML = `<div class="status-text">${icon} ${message}</div>`;
}

// SDK 초기화
async function initPiSDK() {
    try {
        addLog('Pi SDK 로딩 시작...', 'info');
        
        // Pi SDK 객체 확인
        if (typeof Pi === 'undefined') {
            throw new Error('Pi SDK가 로드되지 않았습니다.');
        }
        
        piSDK = Pi;
        addLog('Pi SDK 객체 확인 완료', 'success');
        
        // SDK 초기화
        addLog(`App Key로 초기화 중... (${APP_KEY.substring(0, 8)}...)`, 'info');
        
        await piSDK.init({
            version: "2.0",
            sandbox: true,
            key: APP_KEY
        });
        
        addLog('✓ Pi SDK 초기화 성공!', 'success');
        updateSDKStatus('SDK Ready - 로그인 가능', 'success');
        
        // 로그인 버튼 활성화
        document.getElementById('loginBtn').disabled = false;
        
    } catch (error) {
        addLog(`SDK 초기화 실패: ${error.message}`, 'error');
        updateSDKStatus('SDK 초기화 실패', 'error');
        
        // 재시도 버튼 추가
        const statusBox = document.getElementById('sdkStatus');
        statusBox.innerHTML += `<button onclick="initPiSDK()" style="margin-top: 10px; padding: 5px 15px; border: none; background: #dc3545; color: white; border-radius: 5px; cursor: pointer;">재시도</button>`;
    }
}

// 미완료 결제 처리
function onIncompletePaymentFound(payment) {
    addLog(`미완료 결제 발견: ${payment.identifier}`, 'warning');
    return payment;
}

// 로그인 처리
async function handleLogin() {
    if (!piSDK) {
        addLog('SDK가 초기화되지 않았습니다.', 'error');
        return;
    }
    
    try {
        document.getElementById('loginBtn').disabled = true;
        addLog('Pi 인증 요청 중...', 'info');
        
        const scopes = ['username', 'payments'];
        const authResult = await piSDK.authenticate(scopes, onIncompletePaymentFound);
        
        authenticatedUser = authResult.user.username;
        const uid = authResult.user.uid || 'N/A';
        
        addLog(`✓ 인증 성공! Username: ${authenticatedUser}`, 'success');
        addLog(`UID: ${uid}`, 'info');
        
        // 사용자 정보 표시
        document.getElementById('userName').textContent = `👤 ${authenticatedUser}`;
        document.getElementById('userInfo').classList.add('show');
        
        // 결제 버튼 활성화
        document.getElementById('paymentBtn').disabled = false;
        
        updateSDKStatus(`로그인 완료: ${authenticatedUser}`, 'success');
        
    } catch (error) {
        addLog(`인증 실패: ${error.message}`, 'error');
        document.getElementById('loginBtn').disabled = false;
        updateSDKStatus('인증 실패 - 다시 시도하세요', 'error');
    }
}

// 결제 처리
async function handlePayment() {
    if (!authenticatedUser) {
        addLog('먼저 로그인해주세요.', 'error');
        return;
    }
    
    try {
        document.getElementById('paymentBtn').disabled = true;
        addLog('결제 요청 생성 중...', 'info');
        
        const paymentData = {
            amount: 0.01,
            memo: "FOR Pi MAXIMUM TRANSACTION Demo",
            metadata: {
                app: "for-pi-max-tx",
                type: "demo",
                timestamp: Date.now()
            }
        };
        
        const callbacks = {
            onReadyForServerApproval: function(paymentId) {
                addLog(`✓ 결제 승인 대기: ${paymentId}`, 'success');
                addLog('⚠️ 백엔드 없음: 실제 전송 불가 (데모용)', 'warning');
                updateSDKStatus('결제 승인 대기 중...', 'loading');
            },
            onReadyForServerCompletion: function(paymentId, txid) {
                addLog(`✓ 결제 완료! TxID: ${txid}`, 'success');
                updateSDKStatus('결제 완료!', 'success');
                document.getElementById('paymentBtn').disabled = false;
            },
            onCancel: function(paymentId) {
                addLog(`결제 취소됨: ${paymentId}`, 'warning');
                updateSDKStatus('결제 취소됨', 'error');
                document.getElementById('paymentBtn').disabled = false;
            },
            onError: function(error, payment) {
                addLog(`결제 에러: ${error.message}`, 'error');
                updateSDKStatus('결제 에러 발생', 'error');
                document.getElementById('paymentBtn').disabled = false;
            }
        };
        
        addLog(`결제 금액: ${paymentData.amount} Pi`, 'info');
        const payment = piSDK.createPayment(paymentData, callbacks);
        
        addLog('Pi 앱에서 결제를 확인하세요.', 'info');
        updateSDKStatus('Pi 앱에서 결제 확인 중...', 'loading');
        
    } catch (error) {
        addLog(`결제 요청 실패: ${error.message}`, 'error');
        updateSDKStatus('결제 요청 실패', 'error');
        document.getElementById('paymentBtn').disabled = false;
    }
}

// 페이지 로드 시 자동 초기화
window.addEventListener('DOMContentLoaded', function() {
    addLog('=== FOR Pi MAXIMUM TRANSACTION Demo ===', 'info');
    addLog('페이지 로드 완료', 'info');
    
    // SDK 로드 대기 후 초기화
    if (typeof Pi !== 'undefined') {
        initPiSDK();
    } else {
        addLog('Pi SDK 로드 대기 중...', 'warning');
        setTimeout(initPiSDK, 1000);
    }
});

// 에러 핸들링
window.addEventListener('error', function(e) {
    addLog(`전역 에러: ${e.message}`, 'error');
});
</script>
</body>
</html>
